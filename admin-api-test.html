<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Testing | CompareHubPrices Admin</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #007bff;
            --primary-dark: #0056b3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --dark: #2c3e50;
            --light: #f8f9fa;
            --border: #dee2e6;
            --text: #6c757d;
            --text-dark: #333;
        }

        body {
            background: #f8f9fa;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 3rem;
        }

        .admin-header {
            background: white;
            color: var(--text-dark);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid var(--danger);
        }

        .logo-img {
            height: 50px;
            width: auto;
            object-fit: contain;
        }

        .test-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-card h5 {
            color: var(--dark);
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .method-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-right: 0.5rem;
        }

        .method-get { background: var(--success); color: white; }
        .method-post { background: var(--primary); color: white; }
        .method-put { background: var(--warning); color: var(--dark); }
        .method-delete { background: var(--danger); color: white; }

        .response-box {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .response-box.success {
            border-color: var(--success);
            background: #d4edda;
        }

        .response-box.error {
            border-color: var(--danger);
            background: #f8d7da;
        }

        .btn-test {
            margin-top: 1rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .required {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-auto">
                    <div class="logo">
                        <img src="assets/logo .png" alt="CompareHubPrices" class="logo-img">
                    </div>
                </div>
                <div class="col">
                    <h1><i class="fas fa-flask"></i> API Testing</h1>
                    <p class="mb-0">Test all API endpoints from the frontend</p>
                </div>
                <div class="col-auto">
                    <a href="admin-home.html" class="btn btn-outline-primary me-2">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="index.html" class="btn btn-outline-primary">
                        <i class="fas fa-home"></i> Home
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- API Configuration -->
        <div class="test-card">
            <h5><i class="fas fa-cog"></i> API Configuration</h5>
            <div class="row g-3">
                <div class="col-md-12">
                    <label for="apiBaseUrl" class="form-label">API Base URL</label>
                    <input type="text" class="form-control" id="apiBaseUrl" 
                           value="https://acc.comparehubprices.site/data" 
                           placeholder="https://acc.comparehubprices.site/data">
                    <small class="text-muted">Base URL for all API requests</small>
                </div>
            </div>
        </div>

        <!-- 1. Create Single Product -->
        <div class="test-card">
            <h5>
                <span class="method-badge method-post">POST</span>
                Create Single Product
            </h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Product ID <span class="required">*</span></label>
                    <input type="text" class="form-control" id="createProductId" placeholder="samsung-galaxy-s24-ultra">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Category <span class="required">*</span></label>
                    <select class="form-select" id="createCategory">
                        <option value="smartphones">Smartphones</option>
                        <option value="windows-laptops">Windows Laptops</option>
                        <option value="macbooks-laptops">MacBooks</option>
                        <option value="tablets">Tablets</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Brand <span class="required">*</span></label>
                    <input type="text" class="form-control" id="createBrand" placeholder="Samsung">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Model <span class="required">*</span></label>
                    <input type="text" class="form-control" id="createModel" placeholder="Galaxy S24 Ultra">
                </div>
                <div class="col-12">
                    <button class="btn btn-primary btn-test" onclick="testCreateProduct()">
                        <i class="fas fa-paper-plane"></i> Test Create Product
                    </button>
                </div>
                <div class="col-12" id="createResponse"></div>
            </div>
        </div>

        <!-- 2. List Products -->
        <div class="test-card">
            <h5>
                <span class="method-badge method-get">GET</span>
                List Products
            </h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Category <span class="required">*</span></label>
                    <select class="form-select" id="listCategory">
                        <option value="smartphones">Smartphones</option>
                        <option value="windows-laptops">Windows Laptops</option>
                        <option value="macbooks-laptops">MacBooks</option>
                        <option value="tablets">Tablets</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Brand (Optional)</label>
                    <input type="text" class="form-control" id="listBrand" placeholder="Samsung">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Limit</label>
                    <input type="number" class="form-control" id="listLimit" value="10" min="1" max="100">
                </div>
                <div class="col-12">
                    <button class="btn btn-success btn-test" onclick="testListProducts()">
                        <i class="fas fa-list"></i> Test List Products
                    </button>
                </div>
                <div class="col-12" id="listResponse"></div>
            </div>
        </div>

        <!-- 3. Get Product -->
        <div class="test-card">
            <h5>
                <span class="method-badge method-get">GET</span>
                Get Product by ID
            </h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Product ID <span class="required">*</span></label>
                    <input type="text" class="form-control" id="getProductId" placeholder="samsung-galaxy-s24-ultra">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Category <span class="required">*</span></label>
                    <select class="form-select" id="getCategory">
                        <option value="smartphones">Smartphones</option>
                        <option value="windows-laptops">Windows Laptops</option>
                        <option value="macbooks-laptops">MacBooks</option>
                        <option value="tablets">Tablets</option>
                    </select>
                </div>
                <div class="col-12">
                    <button class="btn btn-success btn-test" onclick="testGetProduct()">
                        <i class="fas fa-search"></i> Test Get Product
                    </button>
                </div>
                <div class="col-12" id="getResponse"></div>
            </div>
        </div>

        <!-- 4. Update Product -->
        <div class="test-card">
            <h5>
                <span class="method-badge method-put">PUT</span>
                Update Product
            </h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Product ID <span class="required">*</span></label>
                    <input type="text" class="form-control" id="updateProductId" placeholder="samsung-galaxy-s24-ultra">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Category <span class="required">*</span></label>
                    <select class="form-select" id="updateCategory">
                        <option value="smartphones">Smartphones</option>
                        <option value="windows-laptops">Windows Laptops</option>
                        <option value="macbooks-laptops">MacBooks</option>
                        <option value="tablets">Tablets</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Brand</label>
                    <input type="text" class="form-control" id="updateBrand" placeholder="Samsung">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Model</label>
                    <input type="text" class="form-control" id="updateModel" placeholder="Galaxy S24 Ultra">
                </div>
                <div class="col-12">
                    <button class="btn btn-warning btn-test" onclick="testUpdateProduct()">
                        <i class="fas fa-edit"></i> Test Update Product
                    </button>
                </div>
                <div class="col-12" id="updateResponse"></div>
            </div>
        </div>

        <!-- 5. Delete Product -->
        <div class="test-card">
            <h5>
                <span class="method-badge method-delete">DELETE</span>
                Delete Product
            </h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Product ID <span class="required">*</span></label>
                    <input type="text" class="form-control" id="deleteProductId" placeholder="samsung-galaxy-s24-ultra">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Category <span class="required">*</span></label>
                    <select class="form-select" id="deleteCategory">
                        <option value="smartphones">Smartphones</option>
                        <option value="windows-laptops">Windows Laptops</option>
                        <option value="macbooks-laptops">MacBooks</option>
                        <option value="tablets">Tablets</option>
                    </select>
                </div>
                <div class="col-12">
                    <button class="btn btn-danger btn-test" onclick="testDeleteProduct()">
                        <i class="fas fa-trash"></i> Test Delete Product
                    </button>
                </div>
                <div class="col-12" id="deleteResponse"></div>
            </div>
        </div>

        <!-- 6. Batch Create Products -->
        <div class="test-card">
            <h5>
                <span class="method-badge method-post">POST</span>
                Batch Create Products
            </h5>
            <div class="row g-3">
                <div class="col-12">
                    <label class="form-label">JSON Products Array</label>
                    <textarea class="form-control font-monospace" id="batchProducts" rows="8" 
                        placeholder='{"products": [{"product_id": "test-1", "category": "smartphones", "brand": "Samsung", "model": "Test 1"}, {"product_id": "test-2", "category": "smartphones", "brand": "Samsung", "model": "Test 2"}]}'></textarea>
                    <small class="text-muted">Enter JSON with products array (max 25 products per batch)</small>
                </div>
                <div class="col-12">
                    <button class="btn btn-primary btn-test" onclick="testBatchCreate()">
                        <i class="fas fa-layer-group"></i> Test Batch Create
                    </button>
                </div>
                <div class="col-12" id="batchResponse"></div>
            </div>
        </div>
    </div>
    <script src="assets/scripts/admin-aws-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Get API Base URL
        function getApiUrl() {
            return document.getElementById('apiBaseUrl').value.trim() || 'https://acc.comparehubprices.site/data';
        }

        // Show response
        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'response-box error' : 'response-box success';
            element.innerHTML = `
                <div class="${className}">
                    <strong>Response:</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }

        // Show error
        function showError(elementId, error) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="response-box error">
                    <strong>Error:</strong><br>
                    <pre>${error.message || error}</pre>
                </div>
            `;
        }

        // 1. Test Create Product
        async function testCreateProduct() {
            const productId = document.getElementById('createProductId').value.trim();
            const category = document.getElementById('createCategory').value;
            const brand = document.getElementById('createBrand').value.trim();
            const model = document.getElementById('createModel').value.trim();

            if (!productId || !category || !brand || !model) {
                showError('createResponse', 'Please fill in all required fields');
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/products/single`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_id: productId,
                        category: category,
                        brand: brand,
                        model: model,
                        color: 'Test Color',
                        description: 'Test product created from API test page',
                        imageUrl: 'https://example.com/image.png',
                        offers: [{
                            retailer: 'Test Store',
                            price: 1000,
                            originalPrice: 1200,
                            url: 'https://example.com'
                        }],
                        specs: {}
                    }),
                });

                const data = await response.json();
                showResponse('createResponse', data, !response.ok);
            } catch (error) {
                showError('createResponse', error);
            }
        }

        // 2. Test List Products
        async function testListProducts() {
            const category = document.getElementById('listCategory').value;
            const brand = document.getElementById('listBrand').value.trim();
            const limit = document.getElementById('listLimit').value;

            if (!category) {
                showError('listResponse', 'Category is required');
                return;
            }

            try {
                let url = `${getApiUrl()}/products?category=${category}&limit=${limit}`;
                if (brand) url += `&brand=${encodeURIComponent(brand)}`;

                const response = await fetch(url);
                const data = await response.json();
                
                // Parse if body is string
                let result = data;
                if (typeof data.body === 'string') {
                    try {
                        result = JSON.parse(data.body);
                    } catch (e) {
                        result = data;
                    }
                }

                showResponse('listResponse', result, !response.ok);
            } catch (error) {
                showError('listResponse', error);
            }
        }

        // 3. Test Get Product
        async function testGetProduct() {
            const productId = document.getElementById('getProductId').value.trim();
            const category = document.getElementById('getCategory').value;

            if (!productId || !category) {
                showError('getResponse', 'Product ID and Category are required');
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/products/${productId}?category=${category}`);
                const data = await response.json();
                
                // Parse if body is string
                let result = data;
                if (typeof data.body === 'string') {
                    try {
                        result = JSON.parse(data.body);
                    } catch (e) {
                        result = data;
                    }
                }

                showResponse('getResponse', result, !response.ok);
            } catch (error) {
                showError('getResponse', error);
            }
        }

        // 4. Test Update Product
        async function testUpdateProduct() {
            const productId = document.getElementById('updateProductId').value.trim();
            const category = document.getElementById('updateCategory').value;
            const brand = document.getElementById('updateBrand').value.trim();
            const model = document.getElementById('updateModel').value.trim();

            if (!productId || !category) {
                showError('updateResponse', 'Product ID and Category are required');
                return;
            }

            const updateData = {
                category: category,
            };

            if (brand) updateData.brand = brand;
            if (model) updateData.model = model;

            try {
                const response = await fetch(`${getApiUrl()}/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData),
                });

                const data = await response.json();
                showResponse('updateResponse', data, !response.ok);
            } catch (error) {
                showError('updateResponse', error);
            }
        }

        // 5. Test Delete Product
        async function testDeleteProduct() {
            const productId = document.getElementById('deleteProductId').value.trim();
            const category = document.getElementById('deleteCategory').value;

            if (!productId || !category) {
                showError('deleteResponse', 'Product ID and Category are required');
                return;
            }

            if (!confirm(`Are you sure you want to delete product "${productId}"?`)) {
                return;
            }

            try {
                const response = await fetch(`${getApiUrl()}/products/${productId}?category=${category}`, {
                    method: 'DELETE',
                });

                const data = await response.json();
                showResponse('deleteResponse', data, !response.ok);
            } catch (error) {
                showError('deleteResponse', error);
            }
        }

        // 6. Test Batch Create
        async function testBatchCreate() {
            const jsonText = document.getElementById('batchProducts').value.trim();

            if (!jsonText) {
                showError('batchResponse', 'Please enter JSON products array');
                return;
            }

            try {
                const requestBody = JSON.parse(jsonText);

                const response = await fetch(`${getApiUrl()}/products/batch`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody),
                });

                const data = await response.json();
                
                // Parse if body is string
                let result = data;
                if (typeof data.body === 'string') {
                    try {
                        result = JSON.parse(data.body);
                    } catch (e) {
                        result = data;
                    }
                }

                showResponse('batchResponse', result, !response.ok);
            } catch (error) {
                showError('batchResponse', error);
            }
        }

        // Load saved API URL
        document.addEventListener('DOMContentLoaded', () => {
            const savedUrl = localStorage.getItem('comparehubprices_api_url');
            if (savedUrl) {
                document.getElementById('apiBaseUrl').value = savedUrl;
            }

            // Save API URL when changed
            document.getElementById('apiBaseUrl').addEventListener('change', (e) => {
                localStorage.setItem('comparehubprices_api_url', e.target.value);
            });
        });
    </script>
</body>
</html>

