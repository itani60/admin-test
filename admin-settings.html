<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | CompareHubPrices Admin</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
    
    <style>
        :root {
            --primary: #007bff;
            --primary-dark: #0056b3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --dark: #2c3e50;
            --light: #f8f9fa;
            --border: #dee2e6;
            --text: #6c757d;
            --text-dark: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f8f9fa;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 3rem;
        }

        .admin-header {
            background: white;
            color: var(--text-dark);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin: 0 1rem 2rem 1rem;
        }

        .admin-header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--dark);
            margin: 0;
        }

        .admin-header p {
            color: var(--text);
            margin: 0.25rem 0 0 0;
            font-size: 0.9rem;
        }

        .container {
            max-width: 1200px;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-img {
            height: 50px;
            width: auto;
            object-fit: contain;
        }

        .settings-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .settings-section h3 {
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-control, .form-select {
            border-radius: 6px;
            border: 1px solid var(--border);
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--danger);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
            outline: none;
        }

        .form-text {
            font-size: 0.85rem;
            color: var(--text);
            margin-top: 0.25rem;
        }

        .btn-primary {
            background: var(--primary);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: var(--success);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            background: #218838;
        }

        .alert {
            border-radius: 6px;
            border: 1px solid;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .alert-success {
            background: #e8f5e9;
            color: var(--success);
            border-color: #c8e6c9;
        }

        .alert-danger {
            background: #fff5f5;
            color: var(--danger);
            border-color: #fecaca;
        }

        .alert-info {
            background: #e7f3ff;
            color: var(--info);
            border-color: #b3d9ff;
        }

        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group-text {
            background: var(--light);
            border: 1px solid var(--border);
            border-right: none;
            padding: 0.75rem 1rem;
            border-radius: 6px 0 0 6px;
            color: var(--text);
        }

        .input-group .form-control {
            border-left: none;
            border-radius: 0 6px 6px 0;
        }

        .test-connection {
            margin-top: 0.5rem;
        }

        .test-result {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .test-result.success {
            background: #e8f5e9;
            color: var(--success);
            border: 1px solid #c8e6c9;
        }

        .test-result.error {
            background: #fff5f5;
            color: var(--danger);
            border: 1px solid #fecaca;
        }

        .test-result.warning {
            background: #fffbf0;
            color: #d97706;
            border: 1px solid #fde68a;
        }

        .test-result.warning code {
            background: #fef3c7;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.85em;
        }

        .test-result.info {
            background: #e7f3ff;
            color: var(--info);
            border: 1px solid #b3d9ff;
        }

        .category-table {
            width: 100%;
            margin-top: 1rem;
        }

        .category-table th {
            background: var(--light);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid var(--border);
        }

        .category-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .category-table tr:hover {
            background: var(--light);
        }

        .badge {
            padding: 0.35rem 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        /* Breadcrumb Styles */
        .breadcrumb-container {
            background: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .breadcrumb {
            background: transparent;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            list-style: none;
            align-items: center;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
        }

        .breadcrumb-item + .breadcrumb-item::before {
            content: "/";
            display: inline-block;
            padding: 0 0.5rem;
            color: var(--text);
            font-weight: 400;
        }

        .breadcrumb-item a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .breadcrumb-item a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .breadcrumb-item.active {
            color: var(--text-dark);
            font-weight: 500;
        }

        .breadcrumb-item.active a {
            color: var(--text-dark);
            pointer-events: none;
            cursor: default;
        }

        .page-title-section {
            margin-bottom: 2rem;
        }

        .page-title-section h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .page-title-section p {
            color: var(--text);
            margin: 0;
            font-size: 0.9rem;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--danger);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .user-name {
            margin: 0;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .logout-btn {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            cursor: pointer;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .login-btn-header {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .login-btn-header:hover {
            background: var(--primary-dark);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-auto">
                    <div class="logo">
                        <img src="assets/logo .png" alt="CompareHubPrices" class="logo-img">
                    </div>
                </div>
                <div class="col-auto ms-auto">
                    <!-- User Section (shown when logged in) -->
                    <div class="user-section" id="userSection">
                        <div class="user-avatar" id="userAvatar">JD</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">John Doe</div>
                        </div>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                    <!-- Login Button (shown when not logged in) -->
                    <a href="admin-login.html" class="login-btn-header" id="loginBtnHeader" style="display: none;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="index.html">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        Settings
                    </li>
                </ol>
            </nav>
        </div>

        <!-- Page Title -->
        <div class="page-title-section">
            <h1><i class="fas fa-cog"></i> Settings</h1>
            <p>Configure API endpoints and system settings</p>
        </div>

        <div id="alertContainer"></div>

        <!-- API Configuration Section -->
        <div class="settings-section">
            <h3><i class="fas fa-link"></i> API Configuration</h3>
            
            <div class="form-group">
                <label for="apiBaseUrl" class="form-label">API Base URL (Products)</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-globe"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrl" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/data"
                        value="https://acc.comparehubprices.site/data"
                    >
                </div>
                <div class="form-text">Base URL for product API requests (e.g., https://acc.comparehubprices.site/data)</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResult"></div>
            </div>

            <div class="form-group">
                <label for="apiBaseUrlAdmin" class="form-label">Admin API Base URL</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user-shield"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrlAdmin" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/admin"
                        value="https://acc.comparehubprices.site/admin"
                    >
                </div>
                <div class="form-text">Base URL for admin API requests</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnectionGeneric('apiBaseUrlAdmin', 'apiTestResultAdmin')">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResultAdmin"></div>
            </div>

            <div class="form-group">
                <label for="apiBaseUrlWishlist" class="form-label">Wishlist API Base URL</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-heart"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrlWishlist" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/wishlist"
                        value="https://acc.comparehubprices.site/wishlist"
                    >
                </div>
                <div class="form-text">Base URL for wishlist API requests</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnectionGeneric('apiBaseUrlWishlist', 'apiTestResultWishlist')">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResultWishlist"></div>
            </div>

            <div class="form-group">
                <label for="apiBaseUrlPriceAlerts" class="form-label">Price Alerts API Base URL</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-bell"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrlPriceAlerts" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/price-alerts"
                        value="https://acc.comparehubprices.site/price-alerts"
                    >
                </div>
                <div class="form-text">Base URL for price alerts API requests</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnectionGeneric('apiBaseUrlPriceAlerts', 'apiTestResultPriceAlerts')">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResultPriceAlerts"></div>
            </div>

            <div class="form-group">
                <label for="apiBaseUrlNotifications" class="form-label">Notifications API Base URL</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-bell"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrlNotifications" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/notifications"
                        value="https://acc.comparehubprices.site/notifications"
                    >
                </div>
                <div class="form-text">Base URL for notifications API requests</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnectionGeneric('apiBaseUrlNotifications', 'apiTestResultNotifications')">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResultNotifications"></div>
            </div>

            <div class="form-group">
                <label for="apiBaseUrlBusiness" class="form-label">Business API Base URL</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-building"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrlBusiness" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/business"
                        value="https://acc.comparehubprices.site/business"
                    >
                </div>
                <div class="form-text">Base URL for business API requests</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnectionGeneric('apiBaseUrlBusiness', 'apiTestResultBusiness')">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResultBusiness"></div>
            </div>

            <div class="form-group">
                <label for="apiBaseUrlAcc" class="form-label">Account API Base URL</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input 
                        type="text" 
                        id="apiBaseUrlAcc" 
                        class="form-control" 
                        placeholder="https://acc.comparehubprices.site/acc"
                        value="https://acc.comparehubprices.site/acc"
                    >
                </div>
                <div class="form-text">Base URL for account API requests</div>
                <button class="btn btn-primary btn-sm test-connection" onclick="testApiConnectionGeneric('apiBaseUrlAcc', 'apiTestResultAcc')">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <div id="apiTestResultAcc"></div>
            </div>

            <div class="form-group">
                <label for="apiRegion" class="form-label">AWS Region</label>
                <select class="form-select" id="apiRegion">
                    <option value="af-south-1" selected>af-south-1 (Cape Town)</option>
                    <option value="us-east-1">us-east-1 (N. Virginia)</option>
                    <option value="us-west-2">us-west-2 (Oregon)</option>
                    <option value="eu-west-1">eu-west-1 (Ireland)</option>
                </select>
                <div class="form-text">AWS region where your resources are deployed</div>
            </div>

            <button class="btn btn-success" onclick="saveApiSettings()">
                <i class="fas fa-save"></i> Save API Settings
            </button>
        </div>

        <!-- Category Table Configuration -->
        <div class="settings-section">
            <h3><i class="fas fa-table"></i> Category Table Configuration</h3>
            <p class="text-muted mb-3">Configure DynamoDB table names for each product category</p>
            
            <table class="category-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Table Name</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="categoryTableBody">
                    <tr>
                        <td><strong>Smartphones</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_smartphones" 
                                   value="comparehubprices-smartphones">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('smartphones')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Windows Laptops</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_windows-laptops" 
                                   value="comparehubprices-windows-laptops">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('windows-laptops')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>MacBooks Laptops</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_macbooks-laptops" 
                                   value="comparehubprices-macbooks-laptops">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('macbooks-laptops')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Chromebooks Laptops</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_chromebooks-laptops" 
                                   value="comparehubprices-chromebooks-laptops">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('chromebooks-laptops')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Tablets</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_tablets" 
                                   value="comparehubprices-tablets">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('tablets')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Wearables</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_wearables" 
                                   value="comparehubprices-wearables">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('wearables')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Televisions</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_televisions" 
                                   value="comparehubprices-televisions">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('televisions')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Audio</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_audio" 
                                   value="comparehubprices-audio">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('audio')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Gaming</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_gaming" 
                                   value="comparehubprices-gaming">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('gaming')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Appliances</strong></td>
                        <td>
                            <input type="text" class="form-control form-control-sm" 
                                   id="table_appliances" 
                                   value="comparehubprices-appliances">
                        </td>
                        <td><span class="badge badge-success">Active</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="testTable('appliances')">
                                <i class="fas fa-check"></i> Test
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <button class="btn btn-success mt-3" onclick="saveTableSettings()">
                <i class="fas fa-save"></i> Save Table Settings
            </button>
        </div>

        <!-- Price History Configuration -->
        <div class="settings-section">
            <h3><i class="fas fa-history"></i> Price History Configuration</h3>
            
            <div class="form-group">
                <label for="priceHistoryTable" class="form-label">Price History Table Name</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-database"></i></span>
                    <input 
                        type="text" 
                        id="priceHistoryTable" 
                        class="form-control" 
                        value="CompareHubPrices-PriceHistory"
                    >
                </div>
                <div class="form-text">DynamoDB table name for storing price history</div>
            </div>

            <button class="btn btn-success" onclick="savePriceHistorySettings()">
                <i class="fas fa-save"></i> Save Price History Settings
            </button>
        </div>

        <!-- System Settings -->
        <div class="settings-section">
            <h3><i class="fas fa-sliders-h"></i> System Settings</h3>
            
            <div class="form-group">
                <label for="defaultPageSize" class="form-label">Default Page Size</label>
                <select class="form-select" id="defaultPageSize">
                    <option value="10">10 items</option>
                    <option value="25" selected>25 items</option>
                    <option value="50">50 items</option>
                    <option value="100">100 items</option>
                </select>
                <div class="form-text">Default number of items per page in product lists</div>
            </div>

            <div class="form-group">
                <label for="maxBatchSize" class="form-label">Maximum Batch Size</label>
                <input 
                    type="number" 
                    id="maxBatchSize" 
                    class="form-control" 
                    value="100"
                    min="1"
                    max="100"
                >
                <div class="form-text">Maximum number of products that can be imported in a single batch</div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="enablePriceAlerts" checked> Enable Price Alerts
                </label>
                <div class="form-text">Allow users to set price alerts for products</div>
            </div>

            <div class="form-group">
                <label class="form-label">
                    <input type="checkbox" id="autoUpdatePrices" checked> Auto-Update Prices
                </label>
                <div class="form-text">Automatically track price changes when updating products</div>
            </div>

            <button class="btn btn-success" onclick="saveSystemSettings()">
                <i class="fas fa-save"></i> Save System Settings
            </button>
        </div>

        <!-- Danger Zone -->
        <div class="settings-section" style="border: 2px solid var(--danger);">
            <h3 style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
            
            <div class="alert alert-danger">
                <strong>Warning:</strong> The actions below are irreversible. Please proceed with caution.
            </div>

            <div class="form-group">
                <label class="form-label">Clear All Settings</label>
                <p class="text-muted">Reset all settings to default values. This will clear all saved configurations.</p>
                <button class="btn btn-danger" onclick="clearAllSettings()">
                    <i class="fas fa-trash"></i> Clear All Settings
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">Export Settings</label>
                <p class="text-muted">Download current settings as JSON file for backup.</p>
                <button class="btn btn-primary" onclick="exportSettings()">
                    <i class="fas fa-download"></i> Export Settings
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">Import Settings</label>
                <p class="text-muted">Upload a JSON file to restore settings from backup.</p>
                <input type="file" id="importSettingsFile" accept=".json" class="form-control mb-2">
                <button class="btn btn-primary" onclick="importSettings()">
                    <i class="fas fa-upload"></i> Import Settings
                </button>
            </div>
        </div>
    </div>
    <script src="assets/scripts/admin-aws-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load saved settings on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
        });

        // Load settings from localStorage
        function loadSettings() {
            // API Base URL (Products)
            const savedApiUrl = localStorage.getItem('comparehubprices_api_url');
            if (savedApiUrl) {
                document.getElementById('apiBaseUrl').value = savedApiUrl;
            }

            // Admin API Base URL
            const savedAdminUrl = localStorage.getItem('comparehubprices_api_url_admin');
            if (savedAdminUrl) {
                document.getElementById('apiBaseUrlAdmin').value = savedAdminUrl;
            }

            // Wishlist API Base URL
            const savedWishlistUrl = localStorage.getItem('comparehubprices_api_url_wishlist');
            if (savedWishlistUrl) {
                document.getElementById('apiBaseUrlWishlist').value = savedWishlistUrl;
            }

            // Price Alerts API Base URL
            const savedPriceAlertsUrl = localStorage.getItem('comparehubprices_api_url_price_alerts');
            if (savedPriceAlertsUrl) {
                document.getElementById('apiBaseUrlPriceAlerts').value = savedPriceAlertsUrl;
            }

            // Notifications API Base URL
            const savedNotificationsUrl = localStorage.getItem('comparehubprices_api_url_notifications');
            if (savedNotificationsUrl) {
                document.getElementById('apiBaseUrlNotifications').value = savedNotificationsUrl;
            }

            // Business API Base URL
            const savedBusinessUrl = localStorage.getItem('comparehubprices_api_url_business');
            if (savedBusinessUrl) {
                document.getElementById('apiBaseUrlBusiness').value = savedBusinessUrl;
            }

            // Account API Base URL
            const savedAccUrl = localStorage.getItem('comparehubprices_api_url_acc');
            if (savedAccUrl) {
                document.getElementById('apiBaseUrlAcc').value = savedAccUrl;
            }

            // API Region
            const savedRegion = localStorage.getItem('comparehubprices_api_region');
            if (savedRegion) {
                document.getElementById('apiRegion').value = savedRegion;
            }

            // Table names
            const categories = [
                'smartphones', 'windows-laptops', 'macbooks-laptops', 
                'chromebooks-laptops', 'tablets', 'wearables', 
                'televisions', 'audio', 'gaming', 'appliances'
            ];
            
            categories.forEach(category => {
                const savedTable = localStorage.getItem(`table_${category}`);
                if (savedTable) {
                    document.getElementById(`table_${category}`).value = savedTable;
                }
            });

            // Price History Table
            const savedPriceHistory = localStorage.getItem('price_history_table');
            if (savedPriceHistory) {
                document.getElementById('priceHistoryTable').value = savedPriceHistory;
            }

            // System Settings
            const savedPageSize = localStorage.getItem('default_page_size');
            if (savedPageSize) {
                document.getElementById('defaultPageSize').value = savedPageSize;
            }

            const savedBatchSize = localStorage.getItem('max_batch_size');
            if (savedBatchSize) {
                document.getElementById('maxBatchSize').value = savedBatchSize;
            }

            const savedPriceAlerts = localStorage.getItem('enable_price_alerts');
            if (savedPriceAlerts !== null) {
                document.getElementById('enablePriceAlerts').checked = savedPriceAlerts === 'true';
            }

            const savedAutoUpdate = localStorage.getItem('auto_update_prices');
            if (savedAutoUpdate !== null) {
                document.getElementById('autoUpdatePrices').checked = savedAutoUpdate === 'true';
            }
        }

        // Save API Settings
        function saveApiSettings() {
            const apiUrl = document.getElementById('apiBaseUrl').value.trim();
            const apiUrlAdmin = document.getElementById('apiBaseUrlAdmin').value.trim();
            const apiUrlWishlist = document.getElementById('apiBaseUrlWishlist').value.trim();
            const apiUrlPriceAlerts = document.getElementById('apiBaseUrlPriceAlerts').value.trim();
            const apiUrlNotifications = document.getElementById('apiBaseUrlNotifications').value.trim();
            const apiUrlBusiness = document.getElementById('apiBaseUrlBusiness').value.trim();
            const apiUrlAcc = document.getElementById('apiBaseUrlAcc').value.trim();
            const region = document.getElementById('apiRegion').value;

            if (!apiUrl) {
                showAlert('Please enter a valid Products API URL', 'danger');
                return;
            }

            localStorage.setItem('comparehubprices_api_url', apiUrl);
            if (apiUrlAdmin) localStorage.setItem('comparehubprices_api_url_admin', apiUrlAdmin);
            if (apiUrlWishlist) localStorage.setItem('comparehubprices_api_url_wishlist', apiUrlWishlist);
            if (apiUrlPriceAlerts) localStorage.setItem('comparehubprices_api_url_price_alerts', apiUrlPriceAlerts);
            if (apiUrlNotifications) localStorage.setItem('comparehubprices_api_url_notifications', apiUrlNotifications);
            if (apiUrlBusiness) localStorage.setItem('comparehubprices_api_url_business', apiUrlBusiness);
            if (apiUrlAcc) localStorage.setItem('comparehubprices_api_url_acc', apiUrlAcc);
            localStorage.setItem('comparehubprices_api_region', region);

            showAlert('API settings saved successfully!', 'success');
        }

        // Test API Connection
        async function testApiConnection() {
            const apiUrl = document.getElementById('apiBaseUrl').value.trim();
            const resultDiv = document.getElementById('apiTestResult');
            
            resultDiv.innerHTML = '<div class="test-result">Testing connection...</div>';

            try {
                const response = await fetch(`${apiUrl}/products?category=smartphones&limit=1`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    resultDiv.innerHTML = '<div class="test-result success"><i class="fas fa-check-circle"></i> Connection successful!</div>';
                } else {
                    resultDiv.innerHTML = `<div class="test-result error"><i class="fas fa-times-circle"></i> Connection failed: HTTP ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error"><i class="fas fa-times-circle"></i> Connection failed: ${error.message}</div>`;
            }
        }

        // Generic Test API Connection for other endpoints
        async function testApiConnectionGeneric(inputId, resultDivId) {
            const apiUrl = document.getElementById(inputId).value.trim();
            const resultDiv = document.getElementById(resultDivId);
            
            if (!apiUrl) {
                resultDiv.innerHTML = '<div class="test-result error"><i class="fas fa-times-circle"></i> Please enter a valid API URL</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="test-result">Testing connection...</div>';

            // Normalize base URL - remove trailing /business or /acc if present
            let normalizedBaseUrl = apiUrl;
            let testPaths = [];
            
            if (normalizedBaseUrl.endsWith('/business')) {
                normalizedBaseUrl = normalizedBaseUrl.replace(/\/business$/, '');
                // Business API endpoints from aws-auth-business.js - exact paths as defined
                testPaths = ['/business/business/login', '/business/business/user-info', '/business/business/get-services', '/business/business/session'];
            } else if (normalizedBaseUrl.endsWith('/acc')) {
                normalizedBaseUrl = normalizedBaseUrl.replace(/\/acc$/, '');
                // Account API endpoints from aws-auth.js - exact paths as defined
                testPaths = ['/acc/auth/login', '/acc/auth/get-user-info', '/acc/auth/get-session'];
            } else if (normalizedBaseUrl.includes('/admin')) {
                testPaths = ['/admin/admin/account/login', '/admin/account/user-info', '/admin'];
            } else if (normalizedBaseUrl.includes('/wishlist')) {
                testPaths = ['/wishlist', '/wishlist/wishlist'];
            } else if (normalizedBaseUrl.includes('/price-alerts')) {
                testPaths = ['/alerts', '/alerts'];
            } else if (normalizedBaseUrl.includes('/notifications')) {
                testPaths = ['/notifications', '/notifications/notifications'];
            } else {
                testPaths = [''];
            }

            try {
                // First, try OPTIONS request (CORS preflight) - this is the best way to test CORS
                try {
                    const optionsResponse = await fetch(normalizedBaseUrl, {
                        method: 'OPTIONS',
                        mode: 'cors',
                        headers: {
                            'Origin': window.location.origin,
                            'Access-Control-Request-Method': 'GET'
                        }
                    });

                    // If OPTIONS succeeds, CORS is definitely configured
                    if (optionsResponse.status >= 200 && optionsResponse.status < 600) {
                        const corsOrigin = optionsResponse.headers.get('Access-Control-Allow-Origin');
                        if (corsOrigin) {
                            resultDiv.innerHTML = '<div class="test-result success"><i class="fas fa-check-circle"></i> Connection successful! CORS is properly configured (OPTIONS preflight works).</div>';
                            return;
                        }
                    }
                } catch (optionsError) {
                    // OPTIONS might not be supported, continue to try GET
                }

                // Try GET requests to actual endpoint paths
                let lastError = null;
                let corsErrorDetected = false;

                for (const path of testPaths) {
                    const testUrl = normalizedBaseUrl + path;
                    try {
                        const response = await fetch(testUrl, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            mode: 'cors',
                            credentials: 'omit'
                        });

                        // Check for CORS headers
                        const corsOrigin = response.headers.get('Access-Control-Allow-Origin');
                        
                        // If we get ANY response status (200-599), it means:
                        // 1. The endpoint is reachable
                        // 2. CORS is configured (otherwise browser would block it before we get here)
                        if (response.status >= 200 && response.status < 600) {
                            if (corsOrigin) {
                                resultDiv.innerHTML = '<div class="test-result success"><i class="fas fa-check-circle"></i> Connection successful! CORS is properly configured.</div>';
                                return;
                            } else {
                                // Got response but no CORS header visible
                                // This might still be OK if API Gateway adds headers automatically
                                resultDiv.innerHTML = '<div class="test-result success"><i class="fas fa-check-circle"></i> Connection successful! API is reachable and responding.</div>';
                                return;
                            }
                        }
                    } catch (fetchError) {
                        const errorMsg = fetchError.message || '';
                        
                        // Check if it's a real CORS error
                        if (errorMsg.includes('CORS policy') || 
                            errorMsg.includes('Access-Control-Allow-Origin') ||
                            (fetchError.name === 'TypeError' && errorMsg.includes('Failed to fetch'))) {
                            corsErrorDetected = true;
                            lastError = fetchError;
                            // Continue to try other paths
                            continue;
                        } else {
                            lastError = fetchError;
                            // Continue to try other paths
                            continue;
                        }
                    }
                }

                // If we got here, all paths failed
                if (corsErrorDetected) {
                    // CORS error detected - verify endpoint is reachable with no-cors
                    try {
                        await fetch(normalizedBaseUrl, {
                            method: 'GET',
                            mode: 'no-cors'
                        });
                        // If no-cors works, endpoint exists but CORS is NOT configured for actual requests
                        resultDiv.innerHTML = '<div class="test-result warning"><i class="fas fa-exclamation-triangle"></i> CORS Error: OPTIONS preflight may work, but actual GET requests are blocked. Ensure your API Gateway CORS is configured to return CORS headers in ALL responses (not just OPTIONS). Also check that your Lambda functions return CORS headers in their responses.</div>';
                        return;
                    } catch (noCorsError) {
                        // Endpoint not reachable
                        resultDiv.innerHTML = `<div class="test-result error"><i class="fas fa-times-circle"></i> Connection failed: Endpoint not reachable. Check if the URL is correct and the service is running.</div>`;
                        return;
                    }
                } else {
                    // Network/connection error
                    const errorMsg = lastError ? lastError.message : 'Unable to reach endpoint';
                    resultDiv.innerHTML = `<div class="test-result error"><i class="fas fa-times-circle"></i> Connection failed: ${errorMsg}. Check if the URL is correct and the service is running.</div>`;
                    return;
                }
            } catch (error) {
                // Final error handler
                const errorMsg = error.message || 'Unknown error';
                resultDiv.innerHTML = `<div class="test-result error"><i class="fas fa-times-circle"></i> Connection failed: ${errorMsg}. Check if the URL is correct and the service is running.</div>`;
            }
        }

        // Test Table
        async function testTable(category) {
            const tableName = document.getElementById(`table_${category}`).value.trim();
            const apiUrl = document.getElementById('apiBaseUrl').value.trim();

            if (!tableName) {
                showAlert(`Please enter a table name for ${category}`, 'danger');
                return;
            }

            try {
                // Test by trying to list products from that category
                const response = await fetch(`${apiUrl}/products?category=${category}&limit=1`);
                
                if (response.ok) {
                    showAlert(`Table "${tableName}" is accessible`, 'success');
                } else {
                    showAlert(`Table "${tableName}" test failed: HTTP ${response.status}`, 'danger');
                }
            } catch (error) {
                showAlert(`Table test failed: ${error.message}`, 'danger');
            }
        }

        // Save Table Settings
        function saveTableSettings() {
            const categories = [
                'smartphones', 'windows-laptops', 'macbooks-laptops', 
                'chromebooks-laptops', 'tablets', 'wearables', 
                'televisions', 'audio', 'gaming', 'appliances'
            ];

            categories.forEach(category => {
                const tableName = document.getElementById(`table_${category}`).value.trim();
                if (tableName) {
                    localStorage.setItem(`table_${category}`, tableName);
                }
            });

            showAlert('Table settings saved successfully!', 'success');
        }

        // Save Price History Settings
        function savePriceHistorySettings() {
            const tableName = document.getElementById('priceHistoryTable').value.trim();
            
            if (!tableName) {
                showAlert('Please enter a price history table name', 'danger');
                return;
            }

            localStorage.setItem('price_history_table', tableName);
            showAlert('Price history settings saved successfully!', 'success');
        }

        // Save System Settings
        function saveSystemSettings() {
            const pageSize = document.getElementById('defaultPageSize').value;
            const batchSize = document.getElementById('maxBatchSize').value;
            const priceAlerts = document.getElementById('enablePriceAlerts').checked;
            const autoUpdate = document.getElementById('autoUpdatePrices').checked;

            localStorage.setItem('default_page_size', pageSize);
            localStorage.setItem('max_batch_size', batchSize);
            localStorage.setItem('enable_price_alerts', priceAlerts);
            localStorage.setItem('auto_update_prices', autoUpdate);

            showAlert('System settings saved successfully!', 'success');
        }

        // Clear All Settings
        function clearAllSettings() {
            if (!confirm('Are you sure you want to clear all settings? This action cannot be undone.')) {
                return;
            }

            // Clear all localStorage items related to settings
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('comparehubprices_') || key.startsWith('table_') || 
                    key.startsWith('price_history_') || key.startsWith('default_') || 
                    key.startsWith('max_') || key.startsWith('enable_') || key.startsWith('auto_')) {
                    localStorage.removeItem(key);
                }
            });
            
            // Clear the new API URL settings
            localStorage.removeItem('comparehubprices_api_url_admin');
            localStorage.removeItem('comparehubprices_api_url_wishlist');
            localStorage.removeItem('comparehubprices_api_url_price_alerts');
            localStorage.removeItem('comparehubprices_api_url_notifications');
            localStorage.removeItem('comparehubprices_api_url_business');
            localStorage.removeItem('comparehubprices_api_url_acc');

            // Reload page to reset form
            location.reload();
        }

        // Export Settings
        function exportSettings() {
            const settings = {
                apiUrl: document.getElementById('apiBaseUrl').value,
                apiUrlAdmin: document.getElementById('apiBaseUrlAdmin').value,
                apiUrlWishlist: document.getElementById('apiBaseUrlWishlist').value,
                apiUrlPriceAlerts: document.getElementById('apiBaseUrlPriceAlerts').value,
                apiUrlNotifications: document.getElementById('apiBaseUrlNotifications').value,
                apiUrlBusiness: document.getElementById('apiBaseUrlBusiness').value,
                apiUrlAcc: document.getElementById('apiBaseUrlAcc').value,
                region: document.getElementById('apiRegion').value,
                tables: {},
                priceHistoryTable: document.getElementById('priceHistoryTable').value,
                defaultPageSize: document.getElementById('defaultPageSize').value,
                maxBatchSize: document.getElementById('maxBatchSize').value,
                enablePriceAlerts: document.getElementById('enablePriceAlerts').checked,
                autoUpdatePrices: document.getElementById('autoUpdatePrices').checked
            };

            const categories = [
                'smartphones', 'windows-laptops', 'macbooks-laptops', 
                'chromebooks-laptops', 'tablets', 'wearables', 
                'televisions', 'audio', 'gaming', 'appliances'
            ];

            categories.forEach(category => {
                settings.tables[category] = document.getElementById(`table_${category}`).value;
            });

            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'comparehubprices-settings.json';
            a.click();
            URL.revokeObjectURL(url);

            showAlert('Settings exported successfully!', 'success');
        }

        // Import Settings
        function importSettings() {
            const fileInput = document.getElementById('importSettingsFile');
            const file = fileInput.files[0];

            if (!file) {
                showAlert('Please select a settings file to import', 'danger');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const settings = JSON.parse(e.target.result);

                    // Apply settings
                    if (settings.apiUrl) document.getElementById('apiBaseUrl').value = settings.apiUrl;
                    if (settings.apiUrlAdmin) document.getElementById('apiBaseUrlAdmin').value = settings.apiUrlAdmin;
                    if (settings.apiUrlWishlist) document.getElementById('apiBaseUrlWishlist').value = settings.apiUrlWishlist;
                    if (settings.apiUrlPriceAlerts) document.getElementById('apiBaseUrlPriceAlerts').value = settings.apiUrlPriceAlerts;
                    if (settings.apiUrlNotifications) document.getElementById('apiBaseUrlNotifications').value = settings.apiUrlNotifications;
                    if (settings.apiUrlBusiness) document.getElementById('apiBaseUrlBusiness').value = settings.apiUrlBusiness;
                    if (settings.apiUrlAcc) document.getElementById('apiBaseUrlAcc').value = settings.apiUrlAcc;
                    if (settings.region) document.getElementById('apiRegion').value = settings.region;
                    if (settings.priceHistoryTable) document.getElementById('priceHistoryTable').value = settings.priceHistoryTable;
                    if (settings.defaultPageSize) document.getElementById('defaultPageSize').value = settings.defaultPageSize;
                    if (settings.maxBatchSize) document.getElementById('maxBatchSize').value = settings.maxBatchSize;
                    if (settings.enablePriceAlerts !== undefined) document.getElementById('enablePriceAlerts').checked = settings.enablePriceAlerts;
                    if (settings.autoUpdatePrices !== undefined) document.getElementById('autoUpdatePrices').checked = settings.autoUpdatePrices;

                    if (settings.tables) {
                        Object.keys(settings.tables).forEach(category => {
                            const input = document.getElementById(`table_${category}`);
                            if (input) input.value = settings.tables[category];
                        });
                    }

                    // Save all settings
                    saveApiSettings();
                    saveTableSettings();
                    savePriceHistorySettings();
                    saveSystemSettings();

                    showAlert('Settings imported successfully!', 'success');
                } catch (error) {
                    showAlert('Error importing settings: ' + error.message, 'danger');
                }
            };
            reader.readAsText(file);
        }

        // Show alert
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            const alertHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert" id="${alertId}">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.innerHTML = alertHTML;
            
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }

        // Check login state and update header
        async function checkLoginState() {
            const userSection = document.getElementById('userSection');
            const loginBtnHeader = document.getElementById('loginBtnHeader');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const logoutBtn = document.getElementById('logoutBtn');

            try {
                const result = await window.adminAWSAuthService.getUserInfo();
                
                if (result.success && result.user) {
                    const user = result.user;
                    let displayName = '';
                    let initials = '';

                    if (user.givenName && user.familyName) {
                        displayName = `${user.givenName} ${user.familyName}`;
                        initials = `${user.givenName.charAt(0)}${user.familyName.charAt(0)}`.toUpperCase();
                    } else if (user.givenName) {
                        displayName = user.givenName;
                        initials = user.givenName.substring(0, 2).toUpperCase();
                    } else if (user.email) {
                        const name = user.email.split('@')[0];
                        displayName = name.charAt(0).toUpperCase() + name.slice(1);
                        initials = name.substring(0, 2).toUpperCase();
                    } else {
                        displayName = 'Admin User';
                        initials = 'AU';
                    }

                    userAvatar.textContent = initials;
                    userName.textContent = displayName;

                    userSection.style.display = 'flex';
                    loginBtnHeader.style.display = 'none';
                } else {
                    userSection.style.display = 'none';
                    loginBtnHeader.style.display = 'inline-flex';
                }
            } catch (error) {
                console.error('Error checking login state:', error);
                userSection.style.display = 'none';
                loginBtnHeader.style.display = 'inline-flex';
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                await window.adminAWSAuthService.logout();
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                sessionStorage.removeItem('admin_logged_in');
                sessionStorage.removeItem('admin_email');
                window.location.href = 'admin-login.html';
            }
        }

        // Initialize login state check
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginState();

            // Attach logout handler
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
        });
    </script>
</body>
</html>

